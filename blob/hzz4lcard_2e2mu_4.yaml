---

setup: INSERT(common_setup_13TeV.yaml:COMMON_SETUP)

category: hzz_13TeV_2e2mu_VHHadrTagged
observation:
    rate: -1
    source:
        path: inputs/data_obs_VHHadrTaggedMor17_2e2mu.root/data_obs
        selection: (mass2e2mu>105.0 && mass2e2mu<140.0)
        observables:
        #the observables names correspond to branches in tree
        #and are interpreted with RooWSFactory. This list is first to be defined.
            - mass4l[INSERT(inputs/yields_per_tag_category_13TeV_2e2mu.yaml:mass_range)]
            - kd[INSERT(inputs/yields_per_tag_category_13TeV_2e2mu.yaml:kd_range)]

functions_and_definitions:
    #level-0 definitions (mu, sigma, width, ...)

systematics:
    - INSERT(inputs/systematics_expt_13TeV.yaml:*:VHHadrTagged:*:*)
    - INSERT(inputs/systematics_theory_13TeV.yaml:*:Any:*:*)
    - INSERT(inputs/systematics_theory_13TeV.yaml:*:VHHadrTagged:*:*)
    - INSERT(inputs/systematics_13TeV_2e2mu.yaml:*:VHHadrTagged:*:*)
    - INSERT(inputs/systematics_leptonScaleAndResol_13TeV.yaml:*:VHHadrTagged:*:*)

processes:
    ggH:
        is_signal : 1
        rate : INSERT(inputs/yields_per_tag_category_13TeV_2e2mu.yaml:VHHadrTagged:ggH)
        functions_and_definitions: &ggH_definitions
            - expr::mean_2e2mu_13('(INSERT(inputs/signal_shape_parametrization_13TeV_ggH_VHHadrTagged.yaml:2e2mu:mean))*(1+0.001*@1)',MH,CMS_hzz4l_scale_2e2mu)
            - expr::sigma_2e2mu_13('(INSERT(inputs/signal_shape_parametrization_13TeV_ggH_VHHadrTagged.yaml:2e2mu:sigma))*(1+@1)',MH,CMS_hzz4l_res_2e2mu)
            - expr::alpha_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_ggH_VHHadrTagged.yaml:2e2mu:alpha)',MH)
            - expr::n_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_ggH_VHHadrTagged.yaml:2e2mu:n)',MH)
            - expr::alpha2_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_ggH_VHHadrTagged.yaml:2e2mu:alpha2)',MH)
            - expr::n2_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_ggH_VHHadrTagged.yaml:2e2mu:n2)',MH)
            - RooDoubleCB::ggH_mass(mass4l, mean_2e2mu_13, sigma_2e2mu_13, alpha_2e2mu_13, n_2e2mu_13, alpha2_2e2mu_13, n2_2e2mu_13)
        templates : 
            - ggH_2d(mass4l,kd, inputs/templates2D/HtoZZ2e2mu_ConditionalSmoothMergedTemplatesForCombine_Nominal.root/T_2D_Sig)
        shape : "PROD::ggH_Conv(ggH_mass,ggH_2d|kd)"

    qqH:
        is_signal : 1
        rate : INSERT(inputs/yields_per_tag_category_13TeV_2e2mu.yaml:VHHadrTagged:qqH)
        functions_and_definitions:
            - expr::meanVBF_2e2mu_13('(INSERT(inputs/signal_shape_parametrization_13TeV_VBFH_VHHadrTagged.yaml:2e2mu:mean))*(1+0.001*@1)',MH,CMS_hzz4l_scale_2e2mu)
            - expr::sigmaVBF_2e2mu_13('(INSERT(inputs/signal_shape_parametrization_13TeV_VBFH_VHHadrTagged.yaml:2e2mu:sigma))*(1+@1)',MH,CMS_hzz4l_res_2e2mu)
            - expr::alphaVBF_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_VBFH_VHHadrTagged.yaml:2e2mu:alpha)',MH)
            - expr::nVBF_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_VBFH_VHHadrTagged.yaml:2e2mu:n)',MH)
            - expr::alpha2VBF_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_VBFH_VHHadrTagged.yaml:2e2mu:alpha2)',MH)
            - expr::n2VBF_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_VBFH_VHHadrTagged.yaml:2e2mu:n2)',MH)
            - RooDoubleCB::qqH_mass(mass4l, meanVBF_2e2mu_13, sigmaVBF_2e2mu_13, alphaVBF_2e2mu_13, nVBF_2e2mu_13, alpha2VBF_2e2mu_13, n2VBF_2e2mu_13)
        templates : 
            - qqH_2d(mass4l,kd, inputs/templates2D/HtoZZ2e2mu_ConditionalSmoothMergedTemplatesForCombine_Nominal.root/T_2D_Sig)
        shape : "PROD::qqH_Conv(qqH_mass,qqH_2d|kd)"

    WH_had:
        is_signal : 1
        rate : INSERT(inputs/yields_per_tag_category_13TeV_2e2mu.yaml:VHHadrTagged:WH_had)
        functions_and_definitions: &WH_had_definitions
            - expr::mean_2e2mu_13('(INSERT(inputs/signal_shape_parametrization_13TeV_WH_had_VHHadrTagged.yaml:2e2mu:mean))*(1+0.001*@1)',MH,CMS_hzz4l_scale_2e2mu)
            - expr::sigma_2e2mu_13('(INSERT(inputs/signal_shape_parametrization_13TeV_WH_had_VHHadrTagged.yaml:2e2mu:sigma))*(1+@1)',MH,CMS_hzz4l_res_2e2mu)
            - expr::alpha_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_WH_had_VHHadrTagged.yaml:2e2mu:alpha)',MH)
            - expr::n_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_WH_had_VHHadrTagged.yaml:2e2mu:n)',MH)
            - expr::alpha2_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_WH_had_VHHadrTagged.yaml:2e2mu:alpha2)',MH)
            - expr::n2_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_WH_had_VHHadrTagged.yaml:2e2mu:n2)',MH)
            - RooDoubleCB::WH_had_mass(mass4l, mean_2e2mu_13, sigma_2e2mu_13, alpha_2e2mu_13, n_2e2mu_13, alpha2_2e2mu_13, n2_2e2mu_13)
        templates : 
            - WH_had_2d(mass4l,kd, inputs/templates2D/HtoZZ2e2mu_ConditionalSmoothMergedTemplatesForCombine_Nominal.root/T_2D_Sig)
        shape : "PROD::WH_had_Conv(WH_had_mass,WH_had_2d|kd)"

    WH_lep:
        is_signal : 1
        rate : INSERT(inputs/yields_per_tag_category_13TeV_2e2mu.yaml:VHHadrTagged:WH_lep)
        functions_and_definitions : 
            - expr::meanWH_lep_2e2mu_13('(INSERT(inputs/signal_shape_parametrization_13TeV_WH_lep_VHHadrTagged.yaml:2e2mu:mean))*(1+0.001*@1)',MH,CMS_hzz4l_scale_2e2mu)
            - expr::sigmaWH_lep_2e2mu_13('(INSERT(inputs/signal_shape_parametrization_13TeV_WH_lep_VHHadrTagged.yaml:2e2mu:sigma))*(1+@1)',MH,CMS_hzz4l_res_2e2mu)
            - expr::alphaWH_lep_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_WH_lep_VHHadrTagged.yaml:2e2mu:alpha)',MH)
            - expr::nWH_lep_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_WH_lep_VHHadrTagged.yaml:2e2mu:n)',MH)
            - expr::alpha2WH_lep_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_WH_lep_VHHadrTagged.yaml:2e2mu:alpha2)',MH)
            - expr::n2WH_lep_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_WH_lep_VHHadrTagged.yaml:2e2mu:n2)',MH)
            - expr::fracWH_lep('INSERT(inputs/signal_shape_parametrization_13TeV_WH_lep_VHHadrTagged.yaml:2e2mu:frac)',MH)
            - expr::LWH_lepmass_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_WH_lep_VHHadrTagged.yaml:2e2mu:ml)',MH)
            - expr::LWH_lepsigma_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_WH_lep_VHHadrTagged.yaml:2e2mu:sl)',MH)
            - RooLandau::WH_lepLandau(mass4l, LWH_lepmass_2e2mu_13, LWH_lepsigma_2e2mu_13)
            - RooDoubleCB::WH_lepCB(mass4l, meanWH_lep_2e2mu_13, sigmaWH_lep_2e2mu_13, alphaWH_lep_2e2mu_13, nWH_lep_2e2mu_13, alpha2WH_lep_2e2mu_13, n2WH_lep_2e2mu_13)
            - SUM::WH_lep_mass(fracWH_lep*WH_lepCB,WH_lepLandau)
        templates : 
            - WH_lep_2d(mass4l,kd, inputs/templates2D/HtoZZ2e2mu_ConditionalSmoothMergedTemplatesForCombine_Nominal.root/T_2D_Sig)
        shape : "PROD::WH_lep_Conv(WH_lep_mass,WH_lep_2d|kd)"

    ZH_had:
        is_signal : 1
        rate : INSERT(inputs/yields_per_tag_category_13TeV_2e2mu.yaml:VHHadrTagged:ZH_had)
        functions_and_definitions: &ZH_had_definitions
            - expr::mean_2e2mu_13('(INSERT(inputs/signal_shape_parametrization_13TeV_ZH_had_VHHadrTagged.yaml:2e2mu:mean))*(1+0.001*@1)',MH,CMS_hzz4l_scale_2e2mu)
            - expr::sigma_2e2mu_13('(INSERT(inputs/signal_shape_parametrization_13TeV_ZH_had_VHHadrTagged.yaml:2e2mu:sigma))*(1+@1)',MH,CMS_hzz4l_res_2e2mu)
            - expr::alpha_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_ZH_had_VHHadrTagged.yaml:2e2mu:alpha)',MH)
            - expr::n_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_ZH_had_VHHadrTagged.yaml:2e2mu:n)',MH)
            - expr::alpha2_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_ZH_had_VHHadrTagged.yaml:2e2mu:alpha2)',MH)
            - expr::n2_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_ZH_had_VHHadrTagged.yaml:2e2mu:n2)',MH)
            - RooDoubleCB::ZH_had_mass(mass4l, mean_2e2mu_13, sigma_2e2mu_13, alpha_2e2mu_13, n_2e2mu_13, alpha2_2e2mu_13, n2_2e2mu_13)
        templates : 
            - ZH_had_2d(mass4l,kd, inputs/templates2D/HtoZZ2e2mu_ConditionalSmoothMergedTemplatesForCombine_Nominal.root/T_2D_Sig)
        shape : "PROD::ZH_had_Conv(ZH_had_mass,ZH_had_2d|kd)"

    ZH_lep:
        is_signal : 1
        rate : INSERT(inputs/yields_per_tag_category_13TeV_2e2mu.yaml:VHHadrTagged:ZH_lep)
        functions_and_definitions : 
            - expr::meanZH_lep_2e2mu_13('(INSERT(inputs/signal_shape_parametrization_13TeV_ZH_lep_VHHadrTagged.yaml:2e2mu:mean))*(1+0.001*@1)',MH,CMS_hzz4l_scale_2e2mu)
            - expr::sigmaZH_lep_2e2mu_13('(INSERT(inputs/signal_shape_parametrization_13TeV_ZH_lep_VHHadrTagged.yaml:2e2mu:sigma))*(1+@1)',MH,CMS_hzz4l_res_2e2mu)
            - expr::alphaZH_lep_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_ZH_lep_VHHadrTagged.yaml:2e2mu:alpha)',MH)
            - expr::nZH_lep_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_ZH_lep_VHHadrTagged.yaml:2e2mu:n)',MH)
            - expr::alpha2ZH_lep_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_ZH_lep_VHHadrTagged.yaml:2e2mu:alpha2)',MH)
            - expr::n2ZH_lep_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_ZH_lep_VHHadrTagged.yaml:2e2mu:n2)',MH)
            - expr::fracZH_lep('INSERT(inputs/signal_shape_parametrization_13TeV_ZH_lep_VHHadrTagged.yaml:2e2mu:frac)',MH)
            - expr::LZH_lepmass_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_ZH_lep_VHHadrTagged.yaml:2e2mu:ml)',MH)
            - expr::LZH_lepsigma_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_ZH_lep_VHHadrTagged.yaml:2e2mu:sl)',MH)
            - RooLandau::ZH_lepLandau(mass4l, LZH_lepmass_2e2mu_13, LZH_lepsigma_2e2mu_13)
            - RooDoubleCB::ZH_lepCB(mass4l, meanZH_lep_2e2mu_13, sigmaZH_lep_2e2mu_13, alphaZH_lep_2e2mu_13, nZH_lep_2e2mu_13, alpha2ZH_lep_2e2mu_13, n2ZH_lep_2e2mu_13)
            - SUM::ZH_lep_mass(fracZH_lep*ZH_lepCB,ZH_lepLandau)
        templates : 
            - ZH_lep_2d(mass4l,kd, inputs/templates2D/HtoZZ2e2mu_ConditionalSmoothMergedTemplatesForCombine_Nominal.root/T_2D_Sig)
        shape : "PROD::ZH_lep_Conv(ZH_lep_mass,ZH_lep_2d|kd)"

    ttH:
        is_signal : 1
        rate : INSERT(inputs/yields_per_tag_category_13TeV_2e2mu.yaml:VHHadrTagged:ttH)
        functions_and_definitions : 
            - expr::meanttH_2e2mu_13('(INSERT(inputs/signal_shape_parametrization_13TeV_ttH_VHHadrTagged.yaml:2e2mu:mean))*(1+0.001*@1)',MH,CMS_hzz4l_scale_2e2mu)
            - expr::sigmattH_2e2mu_13('(INSERT(inputs/signal_shape_parametrization_13TeV_ttH_VHHadrTagged.yaml:2e2mu:sigma))*(1+@1)',MH,CMS_hzz4l_res_2e2mu)
            - expr::alphattH_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_ttH_VHHadrTagged.yaml:2e2mu:alpha)',MH)
            - expr::nttH_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_ttH_VHHadrTagged.yaml:2e2mu:n)',MH)
            - expr::alpha2ttH_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_ttH_VHHadrTagged.yaml:2e2mu:alpha2)',MH)
            - expr::n2ttH_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_ttH_VHHadrTagged.yaml:2e2mu:n2)',MH)
            - expr::fracttH('INSERT(inputs/signal_shape_parametrization_13TeV_ttH_VHHadrTagged.yaml:2e2mu:frac)',MH)
            - expr::LttHmass_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_ttH_VHHadrTagged.yaml:2e2mu:ml)',MH)
            - expr::LttHsigma_2e2mu_13('INSERT(inputs/signal_shape_parametrization_13TeV_ttH_VHHadrTagged.yaml:2e2mu:sl)',MH)
            - RooLandau::ttHLandau(mass4l, LttHmass_2e2mu_13, LttHsigma_2e2mu_13)
            - RooDoubleCB::ttHCB(mass4l, meanttH_2e2mu_13, sigmattH_2e2mu_13, alphattH_2e2mu_13, nttH_2e2mu_13, alpha2ttH_2e2mu_13, n2ttH_2e2mu_13)
            - SUM::ttH_mass(fracttH*ttHCB,ttHLandau)
        templates : 
            - ttH_2d(mass4l,kd, inputs/templates2D/HtoZZ2e2mu_ConditionalSmoothMergedTemplatesForCombine_Nominal.root/T_2D_Sig)
        shape : "PROD::ttH_Conv(ttH_mass,ttH_2d|kd)"

    qqZZ:
        is_signal : 0
        rate : INSERT(inputs/yields_per_tag_category_13TeV_2e2mu.yaml:VHHadrTagged:qqZZ)
        functions_and_definitions : 
        - expr::CBCqqZZ1_2e2mu_13('INSERT(inputs/bkg_shape_parametrization_13TeV_qqZZ_VHHadrTagged.yaml:2e2mu:chebPol1)',MH)
        - expr::CBCqqZZ2_2e2mu_13('INSERT(inputs/bkg_shape_parametrization_13TeV_qqZZ_VHHadrTagged.yaml:2e2mu:chebPol2)',MH)
        - expr::CBCqqZZ3_2e2mu_13('INSERT(inputs/bkg_shape_parametrization_13TeV_qqZZ_VHHadrTagged.yaml:2e2mu:chebPol3)',MH)
        - RooBernstein::qqZZ_mass(mass4l,{CBCqqZZ1_2e2mu_13,CBCqqZZ2_2e2mu_13,CBCqqZZ3_2e2mu_13})
        templates : 
            - qqZZ_2d(mass4l, kd, inputs/templates2D/HtoZZ2e2mu_ConditionalSmoothMergedTemplatesForCombine_Nominal.root/T_2D_qqBkg)
        shape : "PROD::qqZZ_Conv(qqZZ_mass,qqZZ_2d|kd)"

    ggZZ:
        is_signal : 0
        rate : INSERT(inputs/yields_per_tag_category_13TeV_2e2mu.yaml:VHHadrTagged:ggZZ)
        functions_and_definitions : 
        - expr::CBCggZZ1_2e2mu_13('INSERT(inputs/bkg_shape_parametrization_13TeV_ggZZ_VHHadrTagged.yaml:2e2mu:chebPol1)',MH)
        - expr::CBCggZZ2_2e2mu_13('INSERT(inputs/bkg_shape_parametrization_13TeV_ggZZ_VHHadrTagged.yaml:2e2mu:chebPol2)',MH)
        - expr::CBCggZZ3_2e2mu_13('INSERT(inputs/bkg_shape_parametrization_13TeV_ggZZ_VHHadrTagged.yaml:2e2mu:chebPol3)',MH)
        - RooBernstein::ggZZ_mass(mass4l,{CBCggZZ1_2e2mu_13,CBCggZZ2_2e2mu_13,CBCggZZ3_2e2mu_13})
        templates : 
            - ggZZ_2d(mass4l, kd, inputs/templates2D/HtoZZ2e2mu_ConditionalSmoothMergedTemplatesForCombine_Nominal.root/T_2D_ggBkg)
        shape : "PROD::ggZZ_Conv(ggZZ_mass,ggZZ_2d|kd)"

    # zjets:
    #     is_signal : 0
    #     rate : INSERT(inputs/yields_per_tag_category_13TeV_2e2mu.yaml:VHHadrTagged:zjets)
    #     functions_and_definitions:
    #         - EXPR::zjets_mass('0.45*TMath::Landau(@0,131.1,18.1)+0.55*TMath::Landau(@0,133.8,18.9)',mass4l)
    #     templates : 
    #         - zjets_2d(mass4l, kd, inputs/templates2D/HtoZZ2e2mu_ConditionalSmoothMergedTemplatesForCombine_Nominal.root/T_2D_ZX)
    #     templatesUncertainty : CMS_hzz4l_bkg_kdShape
    #     shape : "PROD::zjets_Conv(zjets_mass,zjets_2d|kd)"

